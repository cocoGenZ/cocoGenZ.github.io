{"title":"","uid":"f73a8e23e6f6f669cf99c7dba8fa0722","slug":"EVM Puzzles题解","date":"2023-03-24T14:21:13.801Z","updated":"2023-03-24T14:35:16.633Z","comments":true,"path":"api/articles/EVM Puzzles题解.json","keywords":null,"cover":[],"content":"<pre><code>title: EVM Puzzles题解\r\ndate: 2023-03-24 22:22:57\r\ntags: EVM\r\ncover: 'https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg'</code></pre>\r\n<h1 id=\"配置环境\">配置环境</h1>\r\n<pre><code>git clone https://github.com/fvictorio/evm-puzzles.git\r\ncd evm-puzzles\r\nnpm install\r\nnpx hardhat play</code></pre>\r\n<p>输入这两行代码开始做题</p>\r\n<pre><code>cd evm-puzzles\r\nnpx hardhat play</code></pre>\r\n<h1 id=\"evm.codes\">EVM.codes</h1>\r\n<p>https://www.evm.codes/?fork=merge</p>\r\n<h1 id=\"使用evm.codes调试题目\">使用EVM.codes调试题目</h1>\r\n<p><img src=\"https://s2.loli.net/2023/03/24/XZwVYJA5qvgtP8k.png\" alt=\"image-20230320142436347.png\"></p>\r\n<p>GitHub的仓库网址在https://github.com/fvictorio/evm-puzzles</p>\r\n<p><img src=\"https://s2.loli.net/2023/03/24/tXOjADV9iTmByJ5.png\" alt=\"image-20230320142457251.png\"></p>\r\n<p><img src=\"https://s2.loli.net/2023/03/24/Bsd7ju3U9TQHiPR.png\" alt=\"image-20230320142620030.png\"></p>\r\n<h1 id=\"puzzle-1\">Puzzle 1</h1>\r\n<pre><code>00      34      CALLVALUE\r\n01      56      JUMP\r\n02      FD      REVERT\r\n03      FD      REVERT\r\n04      FD      REVERT\r\n05      FD      REVERT\r\n06      FD      REVERT\r\n07      FD      REVERT\r\n08      5B      JUMPDEST\r\n09      00      STOP</code></pre>\r\n<p><code>CALLVALUE</code>将 msg.value 压入堆栈</p>\r\n<p>我们要跳转到的 PC\r\n必须是一个由<code>JUMPDEST</code>操作码标记的有效目的地</p>\r\n<p>之后，<code>JUMP</code>将从堆栈中弹出顶部元素，即\r\nmsg.value。这相当于调用<code>jump(msg.value)</code>. 它将 PC\r\n更改为我们输入指定的地址。</p>\r\n<p>目标是跳转到 address <code>0x08</code>，所以 8 是正确的输入。</p>\r\n<h1 id=\"puzzle-2\">Puzzle 2</h1>\r\n<pre><code>############\r\n# Puzzle 2 #\r\n############\r\n\r\n00      34      CALLVALUE\r\n01      38      CODESIZE\r\n02      03      SUB\r\n03      56      JUMP\r\n04      FD      REVERT\r\n05      FD      REVERT\r\n06      5B      JUMPDEST\r\n07      00      STOP\r\n08      FD      REVERT\r\n09      FD      REVERT</code></pre>\r\n<p><code>SUB</code>：</p>\r\n<p><img src=\"https://s2.loli.net/2023/03/24/O9yY2uBAeEILXGF.png\" alt=\"image-20230320141429174.png\"></p>\r\n<p>压栈的顺序从<code>00</code>--&gt;<code>09</code></p>\r\n<p>这里的<code>CODESIZE=10</code></p>\r\n<p>先将<code>CALLVALUE</code>压栈再将<code>CODESIZE</code>压栈</p>\r\n<p><code>CODESIZE</code>在上，<code>CALLVALUE</code>在下</p>\r\n<p>所以要求<code>CODESIZE-CALLVALUE=6</code></p>\r\n<p>因此正确输入是4</p>\r\n<h1 id=\"puzzle-3\">Puzzle 3</h1>\r\n<pre><code>############\r\n# Puzzle 3 #\r\n############\r\n\r\n00      36      CALLDATASIZE\r\n01      56      JUMP\r\n02      FD      REVERT\r\n03      FD      REVERT\r\n04      5B      JUMPDEST\r\n05      00      STOP</code></pre>\r\n<p><code>CALLDATASIZE</code>可以获取当前输入的数值的大小</p>\r\n<p>我们需要跳转到<code>0x04</code>，就需要输入一个四字节的数据:<code>0xFFFFFFFF</code></p>\r\n<h1 id=\"puzzle-4\">Puzzle 4</h1>\r\n<pre><code>############\r\n# Puzzle 4 #\r\n############\r\n\r\n00      34      CALLVALUE\r\n01      38      CODESIZE\r\n02      18      XOR\r\n03      56      JUMP\r\n04      FD      REVERT\r\n05      FD      REVERT\r\n06      FD      REVERT\r\n07      FD      REVERT\r\n08      FD      REVERT\r\n09      FD      REVERT\r\n0A      5B      JUMPDEST\r\n0B      00      STOP</code></pre>\r\n<p><code>XOR</code>按位异或</p>\r\n<p><img src=\"https://s2.loli.net/2023/03/24/6BcTouFkmbGj8WY.png\" alt=\"image-20230320143530877.png\"></p>\r\n<p><code>CODESIZE=12</code></p>\r\n<p>题目需要<code>XOR(CALLVALUE,CODESIZE)=0x0A</code>，即<code>XOR(msg.value,12)=0x0A</code></p>\r\n<p><code>XOR</code>(二进制0/1，相同为0，不同为1)</p>\r\n<p><code>12--&gt;1100</code>\r\n<code>0x0A(16进制)--&gt;10(10进制)--&gt;1010</code></p>\r\n<p>得到<code>0110 XOR 1100 = 1010</code></p>\r\n<p><code>0110 --&gt; 6</code></p>\r\n<p>所以正确答案是6</p>\r\n<blockquote>\r\n<p>还有一种方法：<code>XOR(msg.value,12)=0x0A</code></p>\r\n<p>也就是<code>XOR(0x0A,12)=msg.value</code></p>\r\n<p>可以用c语言来计算</p>\r\n<p><img src=\"https://s2.loli.net/2023/03/24/T2m9DJURkuLerxt.png\" alt=\"image-20230320152157510.png\"></p>\r\n</blockquote>\r\n<h1 id=\"puzzle-5\">Puzzle 5</h1>\r\n<pre><code>############\r\n# Puzzle 5 #\r\n############\r\n\r\n00      34          CALLVALUE\r\n01      80          DUP1\r\n02      02          MUL\r\n03      610100      PUSH2 0100\r\n06      14          EQ\r\n07      600C        PUSH1 0C\r\n09      57          JUMPI\r\n0A      FD          REVERT\r\n0B      FD          REVERT\r\n0C      5B          JUMPDEST\r\n0D      00          STOP\r\n0E      FD          REVERT\r\n0F      FD          REVERT</code></pre>\r\n<p><code>CALLVALUE</code>被执行</p>\r\n<pre><code>| 堆叠位置 | 堆栈值 | \r\n| -------------- | -------------- | \r\n| #0 | × |</code></pre>\r\n<p><code>DUP1</code>被执行（复制栈中的第一个值并将其压入栈的第一个位置）</p>\r\n<pre><code>| 堆叠位置 | 堆栈值 | \r\n| -------------- | -------------- | \r\n| #0 | × | \r\n| #1 | × |</code></pre>\r\n<p><code>MUL</code>被执行（弹出堆栈的前两个值并将它们相乘。结果被压回栈）</p>\r\n<pre><code>| 堆叠位置 | 堆栈值 | \r\n| -------------- | -------------- | \r\n| #0 | X * X |</code></pre>\r\n<p><code>PUSH2 0100</code>被执行</p>\r\n<pre><code>| 堆叠位置 | 堆栈值 | \r\n| -------------- | -------------- | \r\n| #0 | 0x0100 | \r\n| #1 | X * X |</code></pre>\r\n<p><code>EQ</code>被执行（从堆栈中弹出 2 个值，如果它们相等，则将 1\r\n压入堆栈，否则压入 0。）</p>\r\n<pre><code>| 堆叠位置 | 堆栈值 | \r\n| -------------- | -------------- | \r\n| #0 | 1 如果 X*X === 0x0100 |</code></pre>\r\n<p><code>PUSH 0C</code>被执行</p>\r\n<pre><code>| 堆叠位置 | 堆栈值 | \r\n| -------------- | -------------- | \r\n| #0 | 0x0C | \r\n| #1 | 1 如果 X*X === 0x0100 |</code></pre>\r\n<p>只有当等于时，EVM才会跳转到位置<code>0x0c</code></p>\r\n<p>十六进制数<code>0x0100</code>表示十进制中的256</p>\r\n<p><code>msg.value=x=sqrt(256)=16</code></p>\r\n<p>所以正确答案是16</p>\r\n<h1 id=\"puzzle-6\">Puzzle 6</h1>\r\n<pre><code>############\r\n# Puzzle 6 #\r\n############\r\n\r\n00      6000      PUSH1 00\r\n02      35        CALLDATALOAD\r\n03      56        JUMP\r\n04      FD        REVERT\r\n05      FD        REVERT\r\n06      FD        REVERT\r\n07      FD        REVERT\r\n08      FD        REVERT\r\n09      FD        REVERT\r\n0A      5B        JUMPDEST\r\n0B      00        STOP</code></pre>\r\n<p><img src=\"https://s2.loli.net/2023/03/24/uVTwjzRxHAbnEdB.png\" alt=\"image-20230320200346608.png\"></p>\r\n<p><code>PUSH1 00</code>偏移量<code>0 bytes</code></p>\r\n<p>最后要到<code>0x0A</code>，用0填充32字节</p>\r\n<p>所以答案为：<code>0x000000000000000000000000000000000000000000000000000000000000000A</code></p>\r\n","feature":true,"text":"title: EVM Puzzles题解 date: 2023-03-24 22:22:57 tags: EVM cover: 'https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg' 配置环境 git clone https://...","link":"","photos":[],"count_time":{"symbolsCount":"3.7k","symbolsTime":"3 mins."},"categories":[],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">配置环境</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#evm.codes\"><span class=\"toc-text\">EVM.codes</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8evm.codes%E8%B0%83%E8%AF%95%E9%A2%98%E7%9B%AE\"><span class=\"toc-text\">使用EVM.codes调试题目</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#puzzle-1\"><span class=\"toc-text\">Puzzle 1</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#puzzle-2\"><span class=\"toc-text\">Puzzle 2</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#puzzle-3\"><span class=\"toc-text\">Puzzle 3</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#puzzle-4\"><span class=\"toc-text\">Puzzle 4</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#puzzle-5\"><span class=\"toc-text\">Puzzle 5</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#puzzle-6\"><span class=\"toc-text\">Puzzle 6</span></a></li></ol>","author":{"name":"cocoZ","slug":"cocoz","avatar":"https://s2.loli.net/2022/12/17/7LdKkiUEVc9wQ1x.jpg","link":"/","description":"想越来越优秀！！！<br/>要变得越来越听话！！！ <br/> @ <b·>QQ:1601760796<b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"","uid":"f73a8e23e6f6f669cf99c7dba8fa0722","slug":"Capture the Ether题解","date":"2023-03-24T15:16:05.955Z","updated":"2023-03-24T15:19:51.574Z","comments":true,"path":"api/articles/Capture the Ether题解.json","keywords":null,"cover":[],"text":"title: Capture the Ether题解 date: 2023-03-24 23:16:57 tags: solidity靶场 cover: 'https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg' 由于Ropsten测...","link":"","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[],"tags":[],"author":{"name":"cocoZ","slug":"cocoz","avatar":"https://s2.loli.net/2022/12/17/7LdKkiUEVc9wQ1x.jpg","link":"/","description":"想越来越优秀！！！<br/>要变得越来越听话！！！ <br/> @ <b·>QQ:1601760796<b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"ChatGPT的搭建","uid":"462812fbbc64f9c8b5d4c209bcb7fd5a","slug":"ChatGPT","date":"2023-03-20T04:15:54.000Z","updated":"2023-03-20T04:19:47.035Z","comments":true,"path":"api/articles/ChatGPT.json","keywords":null,"cover":"https://s2.loli.net/2022/12/17/6h9QCTbrRjUsx1c.jpg","text":"什么是ChatGPT 我是 Assistant，一个由 OpenAI 训练的大型语言模型。我可以回答您的问题，并帮助您了解更多关于特定主题的信息。我并不具备自己的意识，只能通过我所学到的知识来回答问题。如果您有任何其他问题，请随时问我。我很乐意帮助您。 —ChatGPT 什么是O...","link":"","photos":[],"count_time":{"symbolsCount":816,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"ChatGPT","slug":"ChatGPT","count":1,"path":"api/tags/ChatGPT.json"}],"author":{"name":"cocoZ","slug":"cocoz","avatar":"https://s2.loli.net/2022/12/17/7LdKkiUEVc9wQ1x.jpg","link":"/","description":"想越来越优秀！！！<br/>要变得越来越听话！！！ <br/> @ <b·>QQ:1601760796<b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}