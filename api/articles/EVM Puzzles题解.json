{"title":"EVM Puzzles题解","uid":"22c49c6ffbea3c60b8a9bf177b3b8838","slug":"EVM Puzzles题解","date":"2023-03-24T15:32:03.000Z","updated":"2023-03-24T15:34:31.088Z","comments":true,"path":"api/articles/EVM Puzzles题解.json","keywords":null,"cover":"https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg","content":"<h1 id=\"配置环境\"><a href=\"#配置环境\" class=\"headerlink\" title=\"配置环境\"></a>配置环境</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">git clone https://github.com/fvictorio/evm-puzzles.git\ncd evm-puzzles\nnpm install\nnpx hardhat play<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>输入这两行代码开始做题</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">cd evm-puzzles\nnpx hardhat play<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<h1 id=\"EVM-codes\"><a href=\"#EVM-codes\" class=\"headerlink\" title=\"EVM.codes\"></a>EVM.codes</h1><p><a href=\"https://www.evm.codes/?fork=merge\">https://www.evm.codes/?fork=merge</a></p>\n<h1 id=\"使用EVM-codes调试题目\"><a href=\"#使用EVM-codes调试题目\" class=\"headerlink\" title=\"使用EVM.codes调试题目\"></a>使用EVM.codes调试题目</h1><p><img src=\"https://s2.loli.net/2023/03/24/XZwVYJA5qvgtP8k.png\" alt=\"image-20230320142436347.png\"></p>\n<p>GitHub的仓库网址在<a href=\"https://github.com/fvictorio/evm-puzzles\">https://github.com/fvictorio/evm-puzzles</a></p>\n<p><img src=\"https://s2.loli.net/2023/03/24/tXOjADV9iTmByJ5.png\" alt=\"image-20230320142457251.png\"></p>\n<p><img src=\"https://s2.loli.net/2023/03/24/Bsd7ju3U9TQHiPR.png\" alt=\"image-20230320142620030.png\"></p>\n<h1 id=\"Puzzle-1\"><a href=\"#Puzzle-1\" class=\"headerlink\" title=\"Puzzle 1\"></a>Puzzle 1</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">00      34      CALLVALUE\n01      56      JUMP\n02      FD      REVERT\n03      FD      REVERT\n04      FD      REVERT\n05      FD      REVERT\n06      FD      REVERT\n07      FD      REVERT\n08      5B      JUMPDEST\n09      00      STOP<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>CALLVALUE</code>将 msg.value 压入堆栈</p>\n<p>我们要跳转到的 PC 必须是一个由<code>JUMPDEST</code>操作码标记的有效目的地</p>\n<p>之后，<code>JUMP</code>将从堆栈中弹出顶部元素，即 msg.value。这相当于调用<code>jump(msg.value)</code>. 它将 PC 更改为我们输入指定的地址。</p>\n<p>目标是跳转到 address <code>0x08</code>，所以 8 是正确的输入。</p>\n<h1 id=\"Puzzle-2\"><a href=\"#Puzzle-2\" class=\"headerlink\" title=\"Puzzle 2\"></a>Puzzle 2</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">############\n# Puzzle 2 #\n############\n\n00      34      CALLVALUE\n01      38      CODESIZE\n02      03      SUB\n03      56      JUMP\n04      FD      REVERT\n05      FD      REVERT\n06      5B      JUMPDEST\n07      00      STOP\n08      FD      REVERT\n09      FD      REVERT<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>SUB</code>：</p>\n<p><img src=\"https://s2.loli.net/2023/03/24/O9yY2uBAeEILXGF.png\" alt=\"image-20230320141429174.png\"></p>\n<p>压栈的顺序从<code>00</code>—&gt;<code>09</code></p>\n<p>这里的<code>CODESIZE=10</code></p>\n<p>先将<code>CALLVALUE</code>压栈再将<code>CODESIZE</code>压栈</p>\n<p><code>CODESIZE</code>在上，<code>CALLVALUE</code>在下</p>\n<p>所以要求<code>CODESIZE-CALLVALUE=6</code></p>\n<p>因此正确输入是4</p>\n<h1 id=\"Puzzle-3\"><a href=\"#Puzzle-3\" class=\"headerlink\" title=\"Puzzle 3\"></a>Puzzle 3</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">############\n# Puzzle 3 #\n############\n\n00      36      CALLDATASIZE\n01      56      JUMP\n02      FD      REVERT\n03      FD      REVERT\n04      5B      JUMPDEST\n05      00      STOP<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>CALLDATASIZE</code>可以获取当前输入的数值的大小</p>\n<p>我们需要跳转到<code>0x04</code>，就需要输入一个四字节的数据:<code>0xFFFFFFFF</code></p>\n<h1 id=\"Puzzle-4\"><a href=\"#Puzzle-4\" class=\"headerlink\" title=\"Puzzle 4\"></a>Puzzle 4</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">############\n# Puzzle 4 #\n############\n\n00      34      CALLVALUE\n01      38      CODESIZE\n02      18      XOR\n03      56      JUMP\n04      FD      REVERT\n05      FD      REVERT\n06      FD      REVERT\n07      FD      REVERT\n08      FD      REVERT\n09      FD      REVERT\n0A      5B      JUMPDEST\n0B      00      STOP<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>XOR</code>按位异或</p>\n<p><img src=\"https://s2.loli.net/2023/03/24/6BcTouFkmbGj8WY.png\" alt=\"image-20230320143530877.png\"></p>\n<p><code>CODESIZE=12</code></p>\n<p>题目需要<code>XOR(CALLVALUE,CODESIZE)=0x0A</code>，即<code>XOR(msg.value,12)=0x0A</code></p>\n<p><code>XOR</code>(二进制0/1，相同为0，不同为1)</p>\n<p><code>12--&gt;1100</code>    <code>0x0A(16进制)--&gt;10(10进制)--&gt;1010</code></p>\n<p>得到<code>0110 XOR 1100 = 1010</code></p>\n<p><code>0110 --&gt; 6</code></p>\n<p>所以正确答案是6</p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>还有一种方法：<code>XOR(msg.value,12)=0x0A</code></p>\n<p>也就是<code>XOR(0x0A,12)=msg.value</code></p>\n<p>可以用c语言来计算</p>\n<p><img src=\"https://s2.loli.net/2023/03/24/T2m9DJURkuLerxt.png\" alt=\"image-20230320152157510.png\"></p></blockquote>\n<h1 id=\"Puzzle-5\"><a href=\"#Puzzle-5\" class=\"headerlink\" title=\"Puzzle 5\"></a>Puzzle 5</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">############\n# Puzzle 5 #\n############\n\n00      34          CALLVALUE\n01      80          DUP1\n02      02          MUL\n03      610100      PUSH2 0100\n06      14          EQ\n07      600C        PUSH1 0C\n09      57          JUMPI\n0A      FD          REVERT\n0B      FD          REVERT\n0C      5B          JUMPDEST\n0D      00          STOP\n0E      FD          REVERT\n0F      FD          REVERT<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>CALLVALUE</code>被执行</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">| 堆叠位置 | 堆栈值 | \n| -------------- | -------------- | \n| #0 | × |<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p><code>DUP1</code>被执行（复制栈中的第一个值并将其压入栈的第一个位置）</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">| 堆叠位置 | 堆栈值 | \n| -------------- | -------------- | \n| #0 | × | \n| #1 | × |<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>MUL</code>被执行（弹出堆栈的前两个值并将它们相乘。结果被压回栈）</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">| 堆叠位置 | 堆栈值 | \n| -------------- | -------------- | \n| #0 | X * X |<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p><code>PUSH2 0100</code>被执行</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">| 堆叠位置 | 堆栈值 | \n| -------------- | -------------- | \n| #0 | 0x0100 | \n| #1 | X * X |<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p><code>EQ</code>被执行（从堆栈中弹出 2 个值，如果它们相等，则将 1 压入堆栈，否则压入 0。）</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">| 堆叠位置 | 堆栈值 | \n| -------------- | -------------- | \n| #0 | 1 如果 X*X === 0x0100 |<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p><code>PUSH 0C</code>被执行</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">| 堆叠位置 | 堆栈值 | \n| -------------- | -------------- | \n| #0 | 0x0C | \n| #1 | 1 如果 X*X === 0x0100 |<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>只有当等于时，EVM才会跳转到位置<code>0x0c</code></p>\n<p>十六进制数<code>0x0100</code>表示十进制中的256</p>\n<p><code>msg.value=x=sqrt(256)=16</code></p>\n<p>所以正确答案是16</p>\n<h1 id=\"Puzzle-6\"><a href=\"#Puzzle-6\" class=\"headerlink\" title=\"Puzzle 6\"></a>Puzzle 6</h1><pre class=\"line-numbers language-none\"><code class=\"language-none\">############\n# Puzzle 6 #\n############\n\n00      6000      PUSH1 00\n02      35        CALLDATALOAD\n03      56        JUMP\n04      FD        REVERT\n05      FD        REVERT\n06      FD        REVERT\n07      FD        REVERT\n08      FD        REVERT\n09      FD        REVERT\n0A      5B        JUMPDEST\n0B      00        STOP<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p><img src=\"https://s2.loli.net/2023/03/24/uVTwjzRxHAbnEdB.png\" alt=\"image-20230320200346608.png\"></p>\n<p><code>PUSH1 00</code>偏移量<code>0 bytes</code></p>\n<p>最后要到<code>0x0A</code>，用0填充32字节</p>\n<p>所以答案为：<code>0x000000000000000000000000000000000000000000000000000000000000000A</code></p>\n","feature":true,"text":"配置环境git clone https://github.com/fvictorio/evm-puzzles.git cd evm-puzzles npm install npx hardhat play 输入这两行代码开始做题 cd evm-puzzles npx hardha...","link":"","photos":[],"count_time":{"symbolsCount":"3.5k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"EVM","slug":"EVM","count":1,"path":"api/tags/EVM.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83\"><span class=\"toc-text\">配置环境</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#EVM-codes\"><span class=\"toc-text\">EVM.codes</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E4%BD%BF%E7%94%A8EVM-codes%E8%B0%83%E8%AF%95%E9%A2%98%E7%9B%AE\"><span class=\"toc-text\">使用EVM.codes调试题目</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Puzzle-1\"><span class=\"toc-text\">Puzzle 1</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Puzzle-2\"><span class=\"toc-text\">Puzzle 2</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Puzzle-3\"><span class=\"toc-text\">Puzzle 3</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Puzzle-4\"><span class=\"toc-text\">Puzzle 4</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Puzzle-5\"><span class=\"toc-text\">Puzzle 5</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Puzzle-6\"><span class=\"toc-text\">Puzzle 6</span></a></li></ol>","author":{"name":"cocoZ","slug":"cocoz","avatar":"https://s2.loli.net/2022/12/17/7LdKkiUEVc9wQ1x.jpg","link":"/","description":"想越来越优秀！！！<br/>要变得越来越听话！！！ <br/> @ <b·>QQ:1601760796<b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Capture the Ether靶场","uid":"0e030f53c4fb86d5302f4b7a9265440a","slug":"Capture the Ether靶场","date":"2023-03-24T15:33:01.000Z","updated":"2023-03-24T15:34:41.977Z","comments":true,"path":"api/articles/Capture the Ether靶场.json","keywords":null,"cover":"https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg","text":"由于Ropsten测试网被弃用了，就在本地测试 WarmupDeploy a contract 把代码扔remix上部署一下就行了 Call me 先调用callme()函数，就能通过 Choose a nickname 在这里随意传入一个bytes32的字符串就ok Lotte...","link":"","photos":[],"count_time":{"symbolsCount":"2.9k","symbolsTime":"3 mins."},"categories":[],"tags":[{"name":"solidity靶场","slug":"solidity靶场","count":2,"path":"api/tags/solidity靶场.json"}],"author":{"name":"cocoZ","slug":"cocoz","avatar":"https://s2.loli.net/2022/12/17/7LdKkiUEVc9wQ1x.jpg","link":"/","description":"想越来越优秀！！！<br/>要变得越来越听话！！！ <br/> @ <b·>QQ:1601760796<b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"Ethernaut题解","uid":"baf051e8c20586e4bdafd3f442f3dba1","slug":"Ethernaut题解","date":"2023-03-24T15:30:12.000Z","updated":"2023-03-24T15:31:17.301Z","comments":true,"path":"api/articles/Ethernaut题解.json","keywords":null,"cover":"https://s2.loli.net/2022/12/17/eOYWR2zZ9rqSchP.jpg","text":"Ethernaut1.Hello建立MetaMask账号连接一下按F12打开浏览器的控制台，输入help() 使用命令getBalance(player)查询账户余额，显示pending，可以展开看（或者使用await getBalance(player)） ethernaut合...","link":"","photos":[],"count_time":{"symbolsCount":"50k","symbolsTime":"46 mins."},"categories":[],"tags":[{"name":"solidity靶场","slug":"solidity靶场","count":2,"path":"api/tags/solidity靶场.json"}],"author":{"name":"cocoZ","slug":"cocoz","avatar":"https://s2.loli.net/2022/12/17/7LdKkiUEVc9wQ1x.jpg","link":"/","description":"想越来越优秀！！！<br/>要变得越来越听话！！！ <br/> @ <b·>QQ:1601760796<b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}